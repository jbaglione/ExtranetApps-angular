<!-- <div class="mat-typography">
    <h1>
        Hallazgo <small> <small><small> <small>{{hallazgo.titulo | uppercase}}</small></small>
        </small>
        </small>
    </h1>
</div> -->
<div>
    <button mat-raised-button [routerLink]="['/hallazgos']">Volver</button>
    <button mat-raised-button type="submit" (click)="guardarHallazgo()">Guardar</button>
    <!-- <button mat-raised-button type="button" (click)="CheckForm()">CheckForm({{hallazgoForm.valid}})</button> -->
    <!--(click)="guardarHallazgo()" -->
</div>
<br />
<form class="example-form" [formGroup]="hallazgoForm" (ngSubmit)="guardarHallazgo()" novalidate="novalidate">
    <!--#form="ngForm"-->
    <div id="cabecera">

        <mat-form-field class="margin-lr5 very-short-form-field" [hidden]="hallazgo.id==0">
            <input matInput placeholder="NÃºmero" formControlName="numero" type="number">
        </mat-form-field>

        <mat-form-field class="margin-lr5" style="width: 178px;">
            <input matInput [matDatepicker]="picker3" placeholder="Fecha" formControlName="fecha" name="dpFecha">
            <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
            <mat-datepicker #picker3></mat-datepicker>
            <mat-error *ngIf="!hallazgoForm.controls.fecha.valid">
                Debe ingresar una fecha valida.
            </mat-error>
        </mat-form-field>
        <mat-form-field class="margin-lr5 long-form-field">
            <mat-select placeholder="Motivo" formControlName="motivo">
                <mat-option *ngFor="let item of motivos" [value]="item.id ">
                    {{item.descripcion}}
                </mat-option>
            </mat-select>
            <mat-error *ngIf="!hallazgoForm.controls.motivo.valid">
                Debe seleccionar un motivo.
            </mat-error>
        </mat-form-field>
        <mat-form-field class="margin-lr5">
            <input matInput placeholder="Titulo" formControlName="titulo" type="text" name="txtTitulo">
            <mat-error *ngIf="!hallazgoForm.controls.titulo.valid">
                Ingrese un titulo valido.
            </mat-error>
        </mat-form-field>
        <mat-form-field class="margin-lr5">
            <mat-select placeholder="Estado" formControlName="estado">
                <mat-option *ngFor="let item of estados" [value]="item.id ">
                    {{item.descripcion}}
                </mat-option>
            </mat-select>
        </mat-form-field>
    </div>
    <br />
    <div>
        <div id="leftPanel" [hidden]="hallazgo.id==0">
            <div>
                <mat-card>
                    <mat-card-header style="background-color: #f5f5f5">
                        <button mat-icon-button type="button" [hidden]="this.hallazgo.registraciones[this.hallazgo.registraciones.length - 1].id == 0">
                                    <mat-icon class="icon-center"style="margin-right: 5px;" (click)="nuevaRegistracion();">add_circle</mat-icon>
                            </button>
                        <p>Registraciones</p>
                    </mat-card-header>
                    <mat-card-content>
                        <mat-table id="tableR" [dataSource]="mtRegistraciones" matSort class="mat-elevation-z8">
                            <ng-container matColumnDef="usuario">
                                <mat-header-cell *matHeaderCellDef mat-sort-header>
                                    Usuario </mat-header-cell>
                                <mat-cell *matCellDef="let element" class="mat-cell-first" style="margin-right: 8px">
                                    <span class="mobile-label">Usuario:</span> {{element.usuario}}
                                    <!-- <button style="margin-right: 8px" type="button" (click)="verRegistracion(element)" mat-icon-button class="mat-cell-button">{{element.usuario}}</button> -->
                                </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="fecha">
                                <mat-header-cell *matHeaderCellDef mat-sort-header>
                                    Fecha
                                </mat-header-cell>
                                <mat-cell mat-cell *matCellDef="let element">
                                    <span class="mobile-label">Fecha:</span> {{element.fecha | date: 'dd/MM/yyyy'}}
                                </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="hora">
                                <mat-header-cell *matHeaderCellDef mat-sort-header> Hora </mat-header-cell>
                                <mat-cell *matCellDef="let element"><span class="mobile-label">Hora:</span> {{element.hora.substring(0,5)}}
                                </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="descripcion">
                                <mat-header-cell *matHeaderCellDef mat-sort-header> Descripcion </mat-header-cell>
                                <mat-cell *matCellDef="let element"> {{element.descripcion}} </mat-cell>
                            </ng-container>
                            <mat-header-row *matHeaderRowDef="dcRegistraciones"></mat-header-row>
                            <mat-row *matRowDef="let row; columns: dcRegistraciones;" (click)="verRegistracion(row)" [style.background]="highlightedRows.indexOf(row) != -1 ? 'lightblue' : ''"></mat-row>
                        </mat-table>
                    </mat-card-content>
                </mat-card>
            </div>
            <br />
            <br />
        </div>
        <!-- <div class="rightPanelNew"> -->
        <div [className]="hallazgo.id == 0 ? 'rightPanelNew' : 'rightPanelEdit'">
            <mat-card>
                <mat-card-header style="background-color: #f5f5f5">
                    <p style="width: 290px;">Escriba aqui lo que nos quiere comentar</p>

                </mat-card-header>
                <mat-card-content>
                    <mat-form-field style="width:100% !important">
                        <textarea matInput placeholder="Descripcion" formControlName="reg_descripcion" #ta_reg_descripcion></textarea>
                    </mat-form-field>
                    <mat-error *ngIf="!hallazgoForm.controls.reg_descripcion.valid">
                        Debe ingresar una descripcion.
                    </mat-error>
                    <br />
                    <mat-divider></mat-divider>
                    <mat-list>
                        <h3 mat-subheader *ngIf="reg_adjuntos != null && reg_adjuntos.length > 0">Adjuntos</h3>
                        <!-- <a href="file://archivos/shamanadj$/liquidaciones/29143_9408656.jpg" target="_blank">sss</a> -->
                        <mat-list-item *ngFor="let adjunto of reg_adjuntos">
                            <h4 mat-line><a [href]=adjunto.fullPath target="_blank">{{adjunto.name}}</a></h4>
                            <img [src]="adjunto.fullPath" width=35px height=35px>
                        </mat-list-item>
                    </mat-list>
                </mat-card-content>
                <div *ngIf='hallazgo.id != 0 && idRegistracionSeleccionada != 0'>
                    <app-upload [path]='"0" + "-" + hallazgo.id.toString() + "-" + idRegistracionSeleccionada.toString()  + "-" + GetNroRegistros() + "-"' (emitirData)="recargarAdjuntos($event)"></app-upload>
                </div>
            </mat-card>


            <br />
            <br />
        </div>
    </div>
</form>